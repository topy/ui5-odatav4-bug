/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dom/units/Rem","sap/ui/layout/cssgrid/GridLayoutBase","sap/ui/layout/cssgrid/GridSettings","sap/ui/layout/cssgrid/GridBoxLayoutStyleHelper","sap/ui/Device","sap/ui/thirdparty/jquery"],function(t,i,e,s,o,a){"use strict";var r=/^([X][L](?:[1-9]|1[0-2]))? ?([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var n=r.exec("XL7 L6 M4 S2");var l={Phone:"sapUiLayoutCSSGridBoxLayoutSizeS",Tablet:"sapUiLayoutCSSGridBoxLayoutSizeM",Desktop:"sapUiLayoutCSSGridBoxLayoutSizeL",LargeDesktop:"sapUiLayoutCSSGridBoxLayoutSizeXL"};var p={XL:"sapUiLayoutCSSGridBoxLayoutSpanXL7",L:"sapUiLayoutCSSGridBoxLayoutSpanL6",M:"sapUiLayoutCSSGridBoxLayoutSpanM4",S:"sapUiLayoutCSSGridBoxLayoutSpanS2"};var d="0.5rem";var u=i.extend("sap.ui.layout.cssgrid.GridBoxLayout",{metadata:{library:"sap.ui.layout",properties:{boxMinWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxesPerRowConfig:{type:"sap.ui.layout.BoxesPerRowConfig",group:"Behavior",defaultValue:"XL7 L6 M4 S2"}}}});u.prototype.getActiveGridSettings=function(){return new e({gridTemplateColumns:this._getTemplateColumns(),gridGap:d+" "+d})};u.prototype.hasGridPolyfill=function(){return true};u.prototype.getPolyfillSizes=function(i){var e=i.getItems(),s=e.find(function(t){return!t.isA("sap.m.GroupHeaderListItem")}),o=i.$().width(),a=s.$().outerWidth(),r=Math.floor(o/a),n=[],l=0;while(l<e.length){n.push(e[l].$().outerHeight()+"px");if(e[l].isA("sap.m.GroupHeaderListItem")){l+=1}else{l+=r}}return{gap:t.toPx(d),rows:n,columns:new Array(r).fill(a+"px")}};u.prototype._applySingleGridLayout=function(t){if(this.isGridSupportedByBrowser()){i.prototype._applySingleGridLayout.call(this,t)}};u.prototype.renderSingleGridLayout=function(t){this._addSpanClasses(t);if(this.isGridSupportedByBrowser()){t.class("sapUiLayoutCSSGridBoxLayoutContainer")}else{t.class("sapUiLayoutCSSGridBoxLayoutPolyfill")}};u.prototype.onGridAfterRendering=function(t){i.prototype.onGridAfterRendering.call(this,t);if(!this._hasBoxWidth()){this._applySizeClass(t)}if(!this.isGridSupportedByBrowser()){this._calcWidth(t);this._flattenHeight(t);if(!this._hasBoxWidth()){this._applyClassForLastItem(t)}}if(t.isA("sap.f.GridList")&&t.getGrowing()){var e=t._oGrowingDelegate._onAfterPageLoaded;t._oGrowingDelegate._onAfterPageLoaded=function(){e.call(t._oGrowingDelegate);if(!this.isGridSupportedByBrowser()){this._flattenHeight(t);this._calcWidth(t);this._loopOverGridItems(t,function(t){if(!t.classList.contains("sapMGHLI")&&!t.classList.contains("sapUiBlockLayerTabbable")){t.classList.add("sapUiLayoutCSSGridItem")}});if(!this._hasBoxWidth()){this._applyClassForLastItem(t)}}else if(t.isA("sap.f.GridList")&&t.isGrouped()){this._flattenHeight(t)}}.bind(this)}if(!this.isGridSupportedByBrowser()&&!this._dndPolyfillAttached){t.attachEvent("_gridPolyfillAfterDragOver",t,this._polyfillAfterDragOver,this);t.attachEvent("_gridPolyfillAfterDragEnd",t,this._polyfillAfterDragEnd,this);this._dndPolyfillAttached=true}};u.prototype._setGridLayout=function(t,e){var s=sap.ui.getCore().byId(t.parentElement.id);i.prototype._setGridLayout.call(this,t,e);if(this.isGridSupportedByBrowser()&&(s&&s.isA("sap.f.GridList")&&s.isGrouped())){this._flattenHeight(s)}};u.prototype.isResponsive=function(){return true};u.prototype.onGridResize=function(t){if(!this.isGridSupportedByBrowser()||t.control&&t.control.isA("sap.f.GridList")&&t.control.isGrouped()){this._flattenHeight(t.control)}if(!this.isGridSupportedByBrowser()&&!this._hasBoxWidth()){this._applyClassForLastItem(t.control)}if(t){if(!this._hasBoxWidth()){this._applySizeClass(t.control)}}};u.prototype._calcWidth=function(t){var i;if(this._hasBoxWidth()){i=this.getBoxWidth()||this.getBoxMinWidth()}this._loopOverGridItems(t,function(t){if(!t.classList.contains("sapMGHLI")){t.style.width=i}})};u.prototype._flattenHeight=function(t){var i=0;t.$().removeClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight");this._loopOverGridItems(t,function(t){i=Math.max(a(t).outerHeight(),i)});s.setItemHeight(t.getId(),i);t.$().addClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight")};u.prototype._applyClassForLastItem=function(t){var i=0;var e=this.getBoxesPerRowConfig().split(" ");var s=o.media.getCurrentRange("StdExt",t.$().width());var a=l[s.name].substring("sapUiLayoutCSSGridBoxLayoutSize".length);var r;e.forEach(function(t){if(t.indexOf(a)!=-1){r=parseInt(t.substring(a.length))}});this._loopOverGridItems(t,function(t){if(t.classList.contains("sapUiLayoutCSSGridItem")){i++;if(i==r){t.classList.add("sapUiLayoutCSSGridItemLastOnRow");i=0}else{t.classList.remove("sapUiLayoutCSSGridItemLastOnRow")}}else if(t.classList.contains("sapMGHLI")){i=0}})};u.prototype._applySizeClass=function(t){var i=o.media.getCurrentRange("StdExt",t.$().width()),e=l[i.name];t.getGridDomRefs().forEach(function(t){if(!t.classList.contains(e)){Object.keys(l).map(function(i){t.classList.remove(l[i])});t.classList.add(e)}})};u.prototype._getTemplateColumns=function(){var t="";if(this.getBoxWidth()){t="repeat(auto-fit, "+this.getBoxWidth()+")"}else if(this.getBoxMinWidth()){t="repeat(auto-fit, minmax("+this.getBoxMinWidth()+", 1fr))"}return t};u.prototype._hasBoxWidth=function(){if(this.getBoxWidth()||this.getBoxMinWidth()){return true}else{return false}};u.prototype._addSpanClasses=function(t){var i,e=this.getBoxesPerRowConfig(),s,o,a,l;if(this._hasBoxWidth()){return}if(!e||!e.length===0){i=n}else{i=r.exec(e)}if(i){for(var d=1;d<i.length;d++){var u=i[d];if(!u){continue}u=u.toUpperCase();switch(u.substr(0,1)){case"X":if(u.substr(1,1)==="L"){s=this._getBoxesPerRowClass(u,2)}break;case"L":o=this._getBoxesPerRowClass(u,1);break;case"M":a=this._getBoxesPerRowClass(u,1);break;case"S":l=this._getBoxesPerRowClass(u,1);break;default:break}}}s=s||p.XL;o=o||p.L;a=a||p.M;l=l||p.S;t.class(s).class(o).class(a).class(l)};u.prototype._getBoxesPerRowClass=function(t,i){var e=parseInt(t.substr(i,t.length));if(e&&e>0&&e<13){return"sapUiLayoutCSSGridBoxLayoutSpan"+t}};u.prototype._loopOverGridItems=function(t,i){t.getGridDomRefs().forEach(function(t){if(t&&t.children){for(var e=0;e<t.children.length;e++){if(t.children[e].style.display!=="none"&&t.children[e].style.visibility!=="hidden"){i(t.children[e])}}}})};u.prototype._polyfillAfterDragOver=function(t,i){t.getParameter("indicator").addClass("sapUiLayoutCSSGridItem");this._calcWidth(i);this._flattenHeight(i);this._applyClassForLastItem(i)};u.prototype._polyfillAfterDragEnd=function(t,i){t.getParameter("indicator").removeClass("sapUiLayoutCSSGridItem");this._applyClassForLastItem(i)};return u});