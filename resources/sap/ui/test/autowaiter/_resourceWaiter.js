/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./WaiterBase","sap/ui/thirdparty/jquery"],function(e,t){"use strict";var i={PENDING:"PENDING",LOADED:"LOADED",ERROR:"ERROR"};var s=e.extend("sap.ui.test.autowaiter._ResourceWaiter",{constructor:function(){e.apply(this,arguments);this._oLogger.setLevel("TRACE");this._aResources=[];var t=new window.MutationObserver(function(e){e.forEach(function(e){if(e.type==="attributes"&&e.target.tagName==="IMG"){this._trackImage(e.target)}else if(e.type==="childList"){for(var t=0;t<e.addedNodes.length;t+=1){if(e.addedNodes[t].tagName==="IMG"){this._trackImage(e.addedNodes[t])}}if(e.nextSibling&&e.nextSibling.tagName==="IMG"){this._trackImage(e.nextSibling)}if(e.previousSibling&&e.previousSibling.tagName==="IMG"){this._trackImage(e.previousSibling)}}}.bind(this))}.bind(this));this._onElementAvailable("body",function(e){t.observe(e,{attributes:true,attributeFilter:["src"],childList:true,subtree:true})})},hasPending:function(){this._aResources.forEach(function(e){if(e.state===i.PENDING&&e.element.complete){e.state=i.LOADED;this._oLogger.trace("Image with src '"+e.element.src+"' completed")}}.bind(this));var e=this._aResources.filter(function(e){if(!t(e.element).length){this._oLogger.trace("Image with src '"+e.src+"' was removed");return false}return e.state===i.PENDING}.bind(this));var s=e.length>0;if(s){this._oHasPendingLogger.debug("There are "+e.length+" resources still loading");e.forEach(function(e){this._oHasPendingLogger.debug("Pending resource: "+e.src)}.bind(this))}return s},_trackImage:function(e){var t=this._aResources.filter(function(t){return t.element===e})[0];if(t){t.src=e.src;t.state=i.PENDING;this._oLogger.trace("Image with src '"+e.src+"' is updated and pending again")}else{var s={src:e.src,state:i.PENDING,element:e};this._aResources.push(s);this._oLogger.trace("Image with src '"+e.src+"' is tracked");e.addEventListener("load",function(){s.state=i.LOADED;this._oLogger.trace("Image with src '"+e.src+"' loaded successfully")}.bind(this));e.addEventListener("error",function(){s.state=i.ERROR;this._oLogger.trace("Image with src '"+e.src+"' failed to load")}.bind(this))}},_onElementAvailable:function(e,i){var s=t(e);if(s.length){i(s[0])}else{setTimeout(function(){this._onElementAvailable(e,i)}.bind(this),100)}}});return new s});