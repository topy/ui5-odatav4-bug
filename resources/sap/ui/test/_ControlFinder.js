/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/test/OpaPlugin","sap/ui/test/actions/Press","sap/ui/test/_LogCollector","sap/ui/test/_OpaLogger","sap/ui/thirdparty/jquery"],function(e,t,r,n,o,i){"use strict";var a=new t;var s=e.extend("sap.ui.test._ControlFinder",{});var u=o.getLogger("sap.ui.test._ControlFinder");var c=n.getInstance("^((?!autowaiter).)*$");var d=[];s._findControls=function(e){if(f(e)){try{return s._findControls(l(e))}catch(e){u.error(e);return[]}}else{var r=a._getFilteredControls(e);if(r===t.FILTER_FOUND_NO_CONTROLS){return[]}else{return i.isArray(r)?r:[r]}}};s._findElements=function(e){c.start();var t=s._findControls(e);var n=function(e){return(new r).$(e)[0]||e.getDomRef()};var o=t.map(function(t){switch(e.interaction){case"root":return t.getDomRef();case"focus":return t.getFocusDomRef();case"press":var o=(new r)._getAdapter(t);return t.$(o)[0];case"auto":return n(t);default:o=e.interaction&&e.interaction.idSuffix;return o?t.$(o)[0]:n(t)}});d.push(c.getAndClearLog());c.stop();return o};s._getControlForElement=function(e){var t=Object.prototype.toString.call(e)==="[object String]"?"#"+e:e;var r=s._getIdentifiedDOMElement(t).control();return r&&r[0]};s._getControlProperty=function(e,t){var r=i.extend({},e.mProperties,{id:e.getId()});return Object.keys(r).indexOf(t)>-1?r[t]:null};s._getDomElementIDSuffix=function(e,t){var r=e.id;var n="-";var o=t.getId().length;return r.charAt(o)===n&&r.substring(o+1)};s._getIdentifiedDOMElement=function(e){if(typeof e==="string"){e=e.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")}return i(e).closest("[data-sap-ui]")};s._getIdentifiedDOMElementId=function(e){var t=s._getIdentifiedDOMElement(e);return t.attr("data-sap-ui")};s._getLatestLog=function(){return d&&d.pop()};s._isControlInStaticArea=function(e){var t=sap.ui.getCore().getStaticAreaRef();return i.contains(t,e.getDomRef())};function f(e){return e.ancestor||e.descendant}function l(e){var t={};if(e.ancestor){var r=g(e);var n=s._findControls(r)[0];if(n){t.ancestor=n;delete e.ancestor}else{throw new Error("Ancestor not found using selector: "+JSON.stringify(r))}}if(e.descendant){var o=s._findControls(e.descendant)[0];if(o){t.descendant=o;delete e.descendant}else{throw new Error("Descendant not found using selector: "+JSON.stringify(e.descendant))}}if(i.isEmptyObject(t)){return e}else{return i.extend({},e,{matchers:t})}}function g(e){if(i.isArray(e.ancestor)){return{id:e.ancestor[0]}}else{return e.ancestor}}return s});